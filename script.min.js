"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(e=>{console.log("ServiceWorker registration successful")}).catch(e=>{console.log("ServiceWorker registration failed: ",e)})});let deferredPrompt,installButton=document.createElement("button");installButton.id="installButton",installButton.className="install-button",installButton.textContent="Install App",installButton.style.display="none",window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),deferredPrompt=e,installButton.style.display="block"}),installButton.addEventListener("click",async()=>{var e;deferredPrompt&&(deferredPrompt.prompt(),e=(await deferredPrompt.userChoice).outcome,console.log("User response to the install prompt: "+e),deferredPrompt=null,installButton.style.display="none")}),window.addEventListener("appinstalled",()=>{console.log("PWA was installed"),installButton.style.display="none"}),document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("loginForm");let t=document.getElementById("passwordInput"),o=document.getElementById("loginScreen"),n=document.getElementById("mainContent"),r=document.getElementById("loginError");function l(){o.style.display="none",n.style.display="block";{let o=document.getElementById("promptForm"),n=document.getElementById("promptsList"),r=document.getElementById("applicationFilter"),l=document.getElementById("categoryFilter"),e=document.getElementById("clearFilters"),a=document.getElementById("submitBtn"),i=document.getElementById("cancelBtn"),t=document.getElementById("logoutBtn"),s=[],d=null;t.addEventListener("click",function(){confirm("Are you sure you want to logout?")&&(sessionStorage.removeItem("isLoggedIn"),location.reload())});var c=document.querySelector("header");function p(){h(!0),fetch("api.php?action=list").then(e=>e.json()).then(e=>{var t;e.success?(s=e.prompts,t=[...new Set(s.map(e=>e.application))].sort(),r.innerHTML='<option value="">Select Application</option>',t.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,r.appendChild(t)})):y("Error loading prompts: "+e.message,"error")}).catch(e=>{console.error("Error:",e),y("Error loading prompts","error")}).finally(()=>{h(!1)})}function m(){let t=r.value,o=l.value;var e;t&&o?(e=s.filter(e=>e.application===t&&e.category===o),0===(e=e).length?n.innerHTML='<div class="loading">No prompts saved yet. Create your first prompt!</div>':n.innerHTML=e.map(e=>`
            <div class="prompt-card" data-id="${e.id}">
                <div class="prompt-header" onclick="togglePrompt('${e.id}')">
                    <div class="prompt-header-content">
                        <h3>${f(e.title)}</h3>
                        <p class="prompt-details">${f(e.details||"")}</p>
                    </div>
                    <span class="prompt-toggle-icon">â–¶</span>
                </div>
                <div class="prompt-content" id="content-${e.id}" style="display: none;">
                    <div class="prompt-meta">
                        <span class="meta-item"><strong>Category:</strong> ${f(e.category)}</span>
                        <span class="meta-item"><strong>App:</strong> ${f(e.application)}</span>
                    </div>
                    <div class="prompt-text">${f(e.prompt)}</div>
                </div>
                <div class="prompt-actions">
                    <button class="btn-edit" onclick="editPrompt('${e.id}')">Edit</button>
                    <button class="btn-delete" onclick="deletePrompt('${e.id}')">Delete</button>
                    <button class="btn-copy" onclick="copyPrompt('${e.id}')">Copy Prompt</button>
                </div>
            </div>
        `).join("")):n.innerHTML='<div class="no-prompts-message">Please select both application and category to view prompts.</div>'}function u(){o.reset(),document.getElementById("promptId").value="",d=null,a.querySelector(".btn-text").textContent="Save Prompt",i.style.display="none",document.querySelector(".prompt-form-section h2").textContent="Create/Edit Prompt"}function y(e,t){let o=document.createElement("div");o.className="error"===t?"error-message":"success-message",o.textContent=e;t=document.querySelector(".container");t.insertBefore(o,t.firstChild),setTimeout(()=>{o.remove()},5e3)}function g(e,t,o){var n=document.querySelector(".copy-feedback"),n=(n&&n.remove(),document.querySelector(`[data-id="${e}"]`));if(n){let e=document.createElement("div");e.className="copy-feedback "+o,e.textContent=t,n.querySelector(".prompt-actions").insertAdjacentElement("afterend",e),setTimeout(()=>{e.remove()},3e3)}}function v(t,o){var n=document.querySelector(".form-feedback"),n=(n&&n.remove(),document.querySelector(".form-actions"));if(n){let e=document.createElement("div");e.className="form-feedback "+o,e.textContent=t,n.insertAdjacentElement("afterend",e),setTimeout(()=>{e.remove()},3e3)}}function f(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])}function E(e){var t=a.querySelector(".btn-text"),o=a.querySelector(".btn-spinner");e?(t.style.display="none",o.style.display="inline-block",a.disabled=!0):(t.style.display="inline-block",o.style.display="none",a.disabled=!1)}function h(e){var t=document.getElementById("listLoader");t&&(t.style.display=e?"flex":"none")}c&&installButton&&c.appendChild(installButton),p(),o.addEventListener("submit",function(e){e.preventDefault();{e={title:(e=new FormData(o)).get("title"),details:e.get("details"),category:e.get("category"),application:e.get("application"),prompt:e.get("prompt")};let t=d?"update":"create";d&&(e.id=d),E(!0),fetch("api.php?action="+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.success?(v(`Prompt ${"create"==t?"created":"updated"} successfully!`,"success"),u(),p(),setTimeout(()=>{r.value&&l.value&&m()},100)):v("Error: "+e.message,"error")}).catch(e=>{console.error("Error:",e),v("Error saving prompt","error")}).finally(()=>{E(!1)})}}),i.addEventListener("click",function(){u()}),r.addEventListener("change",function(){{let t=r.value;var e;t?(e=[...new Set(s.filter(e=>e.application===t).map(e=>e.category))].sort(),l.innerHTML='<option value="">Select Category</option>',e.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,l.appendChild(t)}),l.disabled=!1,n.innerHTML='<div class="no-prompts-message">Please select a category to view prompts.</div>'):(l.innerHTML='<option value="">Select Category</option>',l.disabled=!0,n.innerHTML='<div class="no-prompts-message">Please select an application and category to view prompts.</div>')}}),l.addEventListener("change",function(){m()}),e.addEventListener("click",function(){r.value="",l.value="",l.disabled=!0,n.innerHTML='<div class="no-prompts-message">Please select an application and category to view prompts.</div>'}),window.editPrompt=function(t){var e=s.find(e=>e.id===t);e&&(document.getElementById("promptId").value=e.id,document.getElementById("title").value=e.title,document.getElementById("details").value=e.details||"",document.getElementById("category").value=e.category,document.getElementById("application").value=e.application,document.getElementById("prompt").value=e.prompt,d=t,a.querySelector(".btn-text").textContent="Update Prompt",i.style.display="inline-block",document.querySelector(".prompt-form-section h2").textContent="Edit Prompt",window.scrollTo(0,0))},window.deletePrompt=function(e){confirm("Are you sure you want to delete this prompt?")&&fetch("api.php?action=delete&id="+e,{method:"DELETE"}).then(e=>e.json()).then(e=>{e.success?(y("Prompt deleted successfully!","success"),p()):y("Error: "+e.message,"error")}).catch(e=>{console.error("Error:",e),y("Error deleting prompt","error")})},window.copyPrompt=function(t){var e=s.find(e=>e.id===t);e&&navigator.clipboard.writeText(e.prompt).then(()=>{g(t,"Prompt copied to clipboard!","success")}).catch(e=>{console.error("Failed to copy:",e),g(t,"Failed to copy prompt","error")})},window.togglePrompt=function(e){var t=document.getElementById("content-"+e),e=document.querySelector(`[data-id="${e}"]`),o=e.querySelector(".prompt-toggle-icon");"none"===t.style.display?(t.style.display="block",o.style.transform="rotate(90deg)",e.classList.add("expanded")):(t.style.display="none",o.style.transform="rotate(0deg)",e.classList.remove("expanded"))}}}"true"===sessionStorage.getItem("isLoggedIn")&&l(),e.addEventListener("submit",function(e){e.preventDefault(),"Password1!"===t.value?(sessionStorage.setItem("isLoggedIn","true"),l()):(r.style.display="block",t.value="",setTimeout(()=>{r.style.display="none"},3e3))})});